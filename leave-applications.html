<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Leave Applications - Smart Attendance System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- AWS Cognito SDK -->
  <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.7/dist/amazon-cognito-identity.min.js"></script>

  <!-- Cognito Config -->
  <script src="cognito-config.js"></script>

  <!-- Auth Functions -->
  <script src="auth.js"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <!-- Firebase Config -->
  <script src="firebase-config.js"></script>

  <style>
    :root {
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
    }

    *::-webkit-scrollbar {
      display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    * {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
    }

    body {
      background: #F8F6F4;
      padding-top: 70px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    /* Navbar */
    .navbar-brand {
      font-weight: 700;
      font-size: 1.4rem;
    }

    /* Section Cards */
    .section-card {
      background: #FFFEF9;
      border-radius: 12px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
      padding: 25px;
      margin-bottom: 25px;
    }

    .section-title {
      font-weight: 600;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 3px solid var(--primary-color);
    }

    /* Stats Cards */
    .stats-card {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      transition: transform 0.2s;
    }

    .stats-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
    }

    .stats-card.warning {
      background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
    }

    .stats-card.success {
      background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
    }

    .stats-card.danger {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    }

    /* Leave Status Badges */
    .leave-status-pending {
      background: #ffc107;
      color: #000;
      padding: 5px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-block;
    }

    .leave-status-approved {
      background: #28a745;
      color: #fff;
      padding: 5px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-block;
    }

    .leave-status-rejected {
      background: #dc3545;
      color: #fff;
      padding: 5px 14px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-block;
    }

    /* Table Row Highlighting */
    .leave-row-pending {
      background-color: #fff9e6;
    }

    .leave-row-approved {
      background-color: #e8f5e9;
    }

    .leave-row-rejected {
      background-color: #ffebee;
    }

    /* Action Buttons */
    .leave-action-btn {
      padding: 5px 12px;
      font-size: 0.85rem;
      border-radius: 6px;
      transition: all 0.2s;
      border: none;
    }

    .leave-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    /* Modal Styling */
    .modal-header-custom {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
    }

    /* Table Styling */
    .table-hover tbody tr:hover {
      background-color: #f5f5f5;
    }

    /* Context Display */
    .context-display {
      background: linear-gradient(135deg, #E8E4F0 0%, #DDD8E8 100%);
      border-left: 4px solid var(--primary-color);
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .context-badge {
      background: white;
      color: var(--primary-color);
      padding: 5px 12px;
      border-radius: 15px;
      font-weight: 600;
      margin: 3px;
      display: inline-block;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.3;
    }

    /* Responsive */
    @media (max-width: 768px) {
      body {
        padding-top: 60px;
      }

      .section-card {
        padding: 15px;
      }

      .stats-card {
        margin-bottom: 15px;
      }

      .table-responsive {
        font-size: 0.85rem;
      }
    }
  </style>
</head>

<body>

  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top shadow">
    <div class="container">
      <a class="navbar-brand" href="main-system.html">
        <i class="bi bi-arrow-left-circle me-2"></i>Leave Applications
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="main-system.html">
              <i class="bi bi-house-door me-1"></i>Main System
            </a>
          </li>
          <li class="nav-item">
            <span class="nav-link" id="userEmail">Loading...</span>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container py-4">

    <!-- Context Display -->
    <div class="context-display" id="contextDisplay">
      <h6 class="mb-2"><i class="bi bi-info-circle me-2"></i>Current Context</h6>
      <span class="context-badge" id="contextDept">Department: --</span>
      <span class="context-badge" id="contextCourse">Course: --</span>
      <span class="context-badge" id="contextAcYear">Academic Year: --</span>
      <span class="context-badge" id="contextDivision">Division: --</span>
      <span class="context-badge" id="contextMonth">Month: --</span>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="stats-card">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">Total Applications</h6>
              <h3 class="mb-0" id="statsTotalLeaves">0</h3>
            </div>
            <i class="bi bi-clipboard-check fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card warning">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">Pending</h6>
              <h3 class="mb-0" id="statsPendingLeaves">0</h3>
            </div>
            <i class="bi bi-clock-history fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card success">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">Approved</h6>
              <h3 class="mb-0" id="statsApprovedLeaves">0</h3>
            </div>
            <i class="bi bi-check-circle fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card danger">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">Rejected</h6>
              <h3 class="mb-0" id="statsRejectedLeaves">0</h3>
            </div>
            <i class="bi bi-x-circle fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Section -->
    <section class="section-card">
      <h4 class="section-title">
        <i class="bi bi-calendar-x me-2"></i>Leave Application Management
      </h4>

      <!-- Controls Row -->
      <div class="row mb-3 align-items-end">
        <div class="col-md-3" style="display: none;">
          <button class="btn btn-primary w-100" id="openLeaveFormBtn">
            <i class="bi bi-plus-circle me-1"></i>Submit New Leave
          </button>
        </div>
        <div class="col-md-3">
          <label class="form-label fw-bold small">Filter by Status</label>
          <select id="leaveStatusFilter" class="form-select">
            <option value="all">All Applications</option>
            <option value="pending">Pending Only</option>
            <option value="approved">Approved Only</option>
            <option value="rejected">Rejected Only</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label fw-bold small">Filter by Month</label>
          <select id="leaveMonthFilter" class="form-select">
            <option value="current">Current Month</option>
            <option value="all">All Months</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label fw-bold small">&nbsp;</label>
          <button class="btn btn-outline-secondary w-100" id="refreshLeavesBtn">
            <i class="bi bi-arrow-clockwise me-1"></i>Refresh
          </button>
        </div>
      </div>

      <!-- Leave Applications Table -->
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-light">
            <tr>
              <th width="8%">ID</th>
              <th width="15%">Student Name</th>
              <th width="12%">From</th>
              <th width="12%">To</th>
              <th width="8%">Days</th>
              <th width="20%">Reason</th>
              <th width="10%">Status</th>
              <th width="15%">Actions</th>
            </tr>
          </thead>
          <tbody id="leaveTableBody">
            <tr>
              <td colspan="8" class="empty-state">
                <i class="bi bi-inbox"></i>
                <p class="mt-2 mb-0">No leave applications yet</p>
                <small>Click "Submit New Leave" to add one</small>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

    </section>

  </div>

  <!-- Leave Submission Modal -->
  <div class="modal fade" id="leaveModal" tabindex="-1" aria-labelledby="leaveModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <!-- Header -->
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="leaveModalLabel">
            <i class="bi bi-calendar-x me-2"></i>Submit Leave Application
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <!-- Body -->
        <div class="modal-body">

          <!-- Validation Alert -->
          <div id="leaveValidationAlert" class="alert alert-warning" style="display: none;">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <span id="leaveValidationMsg"></span>
          </div>

          <!-- Student Selection -->
          <div class="mb-3">
            <label class="form-label fw-bold">
              Student <span class="text-danger">*</span>
            </label>
            <select id="leaveStudentSelect" class="form-select" required>
              <option value="">-- Select Student --</option>
            </select>
            <small class="text-muted">Select from students in current division</small>
          </div>

          <!-- Date Range -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label fw-bold">
                From Date <span class="text-danger">*</span>
              </label>
              <input type="date" id="leaveFromDate" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label fw-bold">
                To Date <span class="text-danger">*</span>
              </label>
              <input type="date" id="leaveToDate" class="form-control" required>
            </div>
          </div>

          <!-- Day Count Display -->
          <div class="alert alert-info mb-3" id="leaveDayCountAlert" style="display: none;">
            <i class="bi bi-calendar-check me-2"></i>
            <strong>Total Leave Days:</strong> <span id="totalLeaveDays">0</span> day(s)
            <div id="leaveDaysList" class="mt-1 small"></div>
          </div>

          <!-- Reason -->
          <div class="mb-3">
            <label class="form-label fw-bold">
              Reason <span class="text-danger">*</span>
            </label>
            <textarea id="leaveReason" class="form-control" rows="3"
              placeholder="e.g., Sick - High Fever, Family Emergency, Medical Appointment" required></textarea>
            <small class="text-muted">Please provide detailed reason for leave</small>
          </div>

        </div>

        <!-- Footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-1"></i>Cancel
          </button>
          <button type="button" class="btn btn-primary" id="submitLeaveBtn">
            <i class="bi bi-check-circle me-1"></i>Submit Leave
          </button>
        </div>

      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="leave.js"></script>

</body>

</html>